<!DOCTYPE html>
<head>
<title>Easy Control</title>
<link rel="stylesheet" href="main.css">

</head>
<body>
<p id="result">Init result:</p><p id="result2"></p>
<font id="title">Easy Control</font><p><br>

<div id="content">

	<div id="analog">
		<div class="analogclass">
			<img class="analogsensor" src="img/light.png" />
			<span class="analogvalue" id="lightvalue">none</span><br>
		</div>
		<p>
		<div class="analogclass">
			<img class="analogsensor" src="img/temp.png" />
			<span class="analogvalue" id="temperaturevalue">none</span>
		</div>
	</div>
	<div id="rgb">
		<img class="rgbled" src="img/rgb.png" />
		<table style="margin: 0 auto; margin-top: 10px;">
			<tr style="text-align: center;">
				<td><font color="red"><b>Red</b></font></td>
				<td><font color="green"><b>green</b></font></td>
				<td><font color="blue"><b>blue</b></font></td>
			</tr>
			<tr style="text-align: center;">
				<td id="redvalue">0</td>
				<td id="greenvalue">0</td>
				<td id="bluevalue">0</td>
			</tr>
			<tr>
				<td><input Onchange="changeColor();" type="range" id="rled" class="ledbar" value="0" min="0" max="255"></td>
				<td><input Onchange="changeColor();" type="range" id="gled" class="ledbar" value="0" min="0" max="255"></td>
				<td><input Onchange="changeColor();" type="range" id="bled" class="ledbar" value="0" min="0" max="255"></td>
			</tr>
		</table>
		<span id="showcolor"></span>
	</div>

</div>

<script>
	
	var lightdata;
	var tempdata;
	var celsius;
	setup();
	// Analog
	function loop() {
		if(cpf){
	
			lightdata = cpf.get("light sensor");
			tempdata = cpf.get("temperature sensor");
			celsius = toCelsius(tempdata);
				
	 		document.getElementById("lightvalue").innerHTML = lightdata;
			document.getElementById("temperaturevalue").innerHTML = celsius;
			var randomtmp = Math.floor((Math.random() * 2));
			//cpf.request('["tone_play", 6, 261, 300],["sleep", 300],["tone_play", 6, 293, 300],["sleep", 300],["tone_play", 6, 329, 300],["sleep", 300],["tone_play", 6, 349, 300],["sleep", 300],["tone_play", 6, 392, 300],["sleep", 300],["tone_play", 6, 440, 300],["sleep", 300],["tone_play", 6, 493, 300],["sleep", 300],["tone_play", 6, 349, 523]');
			//var ret2 = cpf.request('["servo_pos", 2, 180]'); //two servos run at the same time
			//cpf.request('["servo_pos", 2, 60, 30]'); //run separately
		 	//cpf.request('["servo_pos", 3, 60, 30]');
			//document.getElementById("result2").innerHTML = "request result:" + ret2;
			
			var ret = cpf.request('["digitalwrite", 2, 1],["digitalwrite", 4, 1]');
			var ret = cpf.request('["grove_setColorRGB", 7, 255, 0, 255]');

			 cpf.sleep(2000);
			var ret = cpf.request('["digitalwrite", 2, 0],["digitalwrite", 4, 0]');
			
			 cpf.sleep(2000);
			var ret = cpf.request('["digitalwrite", 2, 1],["digitalwrite", 4, 1]');
			//cpf.request('["servo_pos", 2, 180],["servo_pos", 3, 180]');
			cpf.request('["servo_pos", 2, 90]');
			//cpf.request('["servo_pos", 3, 180, 30]');
	cpf.sleep(5000);
		}
		setTimeout("loop()", 1000);
	}
	loop();
	
	// RGB
	function changeColor() {
		var Rled = document.getElementById("rled").value;
		var Gled = document.getElementById("gled").value;
		var Bled = document.getElementById("bled").value;
		
		document.getElementById("redvalue").innerHTML = Rled;
		document.getElementById("greenvalue").innerHTML = Gled;
		document.getElementById("bluevalue").innerHTML = Bled;
		
		document.getElementById("showcolor").style.backgroundColor = 'rgb(' + Rled + ',' + Gled + ',' + Bled + ')';
		
		if(cpf){
			cpf.setChainableLed("0," + Rled + "," + Gled + "," + Bled + ";");
			
		}
		
	}
	
	// Temperature
	function toCelsius(value) {
		var resistance = parseFloat((1023-value) * 10000 / value);
		var temperature = 1 / (Math.log(resistance / 10000) / 3975+1 / 298.15) - 273.15;
		
		return temperature.toFixed(2);
	}
	
	// cpf setup
	function setup(){
		if(cpf)
			var ret = cpf.setPinMode('["resetPin"],["setPinMode", "digital", 2, "OUTPUT"],["setPinMode", "digital", 4, "OUTPUT"] ["grove_newChainableLED",7,8,1] ');
			//var ret = cpf.request('[\"resetPin\"],[\"setPinMode\", \"analog\", 0, \"INPUT\"],[\"setPinMode\", \"analog\", 1,\"INPUT\"],[\"setPinMode\", \"digital\", 2,\"OUTPUT\"],[\"grove_newChainableLED\", 7, 8, 1]');
			//var ret = cpf.setPinMode('["resetPin"],["setPinMode","digital",6, "TONE"],["servo_init",2,90,900,2100],["servo_init",3,90,500,2400]'); //for SG90
			
			
			document.getElementById("result").innerHTML += ret + "<br>";
	}
	
</script>
</body>
</html>
